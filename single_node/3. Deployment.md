## ğŸ§© Deployment

Deployment adalah **controller** di Kubernetes yang mengelola Pod secara otomatis.

---

Kalau Pod adalah â€œcontainerâ€,
maka Deployment adalah manager yang memastikan container itu selalu sesuai keadaan yang diinginkan.

Anatomi dari deployment jika digambarkan:

---

- Deployment
  - ReplicaSet
    - Pod
    - Pod

---

Fungsi utama Deployment:

---
- Membuat dan menjaga jumlah Pod (replica)

- Melakukan rolling update dan rollback otomatis

- Mengatur strategi update (blue/green, rolling, canary, dll)

- Menghapus atau menambah Pod jika node mati atau ada perubahan konfigurasi

---

## âš™ï¸ Membuat Deployment

Membuat deployment dapat menggunakan dua cara yang sama dengan membuat pod yaitu imperatif, atau deklaratif. Adapun kedua cara tersebut sebagai berikut:

1. Imperatif
```
kubectl create deployment <nama_deployment> --image=<nama_image:tag>

contoh:

kubectl create deployment webapp --image=nginx:alpine

```
2. Deklaratif

    2.1. Buat file .yaml

```yaml
apiVersion: apps/v1                 # Versi API untuk Deployment
kind: Deployment                    # Jenis resource yang dibuat
metadata:
  name: webapp                      # Nama Deployment
spec:
  replicas: 2                       # Jumlah Pod (replica) yang dijalankan
  selector:                         # Filter untuk memilih Pod yang dikelola
    matchLabels:
      app: webapp                   # Harus cocok dengan label di template
  template:                         # Template Pod yang akan dibuat
    metadata:
      labels:
        app: webapp                 # Label Pod, digunakan oleh selector & Service
    spec:
      containers:
      - name: nginx                 # Nama container di dalam Pod
        image: nginx:alpine         # Image Docker yang digunakan
        ports:
        - containerPort: 80         # Port aplikasi di dalam container


```

2.2 Jalankan perintah berikut:
```
kubectl apply -f <nama_file>.yaml

contoh:

kubectl apply -f webapp-deployment.yaml

```


## ğŸ” Cek Deployment

1. Lihat Deployment, ReplicaSet, dan Pod
```
kubectl get deploy,rs,pods
```
2. Lihat detail Deployment
```
kubectl describe deployment <nama_deployment>
```
3. Lihat label selector
```
kubectl get pods --show-labels
```


## ğŸ” Mengelola Deployment

1. ğŸ”„ Update image (rolling update)
```
kubectl set image deployment/<nama_deployment> nginx=<nama_image:tag>

contoh 

kubectl set image deployment/webapp nginx=nginx:latest
```
Kubernetes akan **rolling update**:

---

- Membuat Pod baru dengan versi baru

- Menghapus Pod lama setelah yang baru â€œreadyâ€

---

Lihat statusnya:
```
kubectl rollout status deployment/webapp

```

2. ğŸ”™ Rollback ke versi sebelumnya
```
kubectl rollout undo deployment/webapp
```

3. ğŸ” Restart deployment
```
kubectl rollout restart deployment/webapp
```

4. ğŸ“ˆ Scale (ubah jumlah Pod)
```
kubectl scale deployment webapp --replicas=3
```
Atau ubah langsung di file YAML (`spec.replicas`) lalu `kubectl apply -f webapp-deployment.yaml`.

5. ğŸ§¹ Menghapus Deployment
```
kubectl delete deployment <nama_deployment>
```

## ğŸ§  Perbedaan Pod vs Deployment
| Aspek       | Pod                     | Deployment               |
| ----------- | ----------------------- | ------------------------ |
| Tujuan      | Jalankan 1 container    | Mengelola sekumpulan Pod |
| Restart     | Manual                  | Otomatis (auto-heal)     |
| Scaling     | Tidak bisa              | Bisa (replicas)          |
| Update      | Harus delete & recreate | Rolling update otomatis  |
| Cocok untuk | Testing cepat           | Aplikasi jangka panjang  |
